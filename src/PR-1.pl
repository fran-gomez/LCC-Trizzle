:- use_module(library(clpfd)).
:- use_rendering(table).

% El predicado aumentar/2 recibe una mamushka y almacena la
% mamushka del siguiente tama침o.
aumentar(r1, r2).
aumentar(r2, r3).
aumentar(r3, r3).

aumentar(v1, v2).
aumentar(v2, v3).
aumentar(v3, v3).

aumentar(a1, a2).
aumentar(a2, a3).
aumentar(a3, a3).

% El predicado desplazar es el encargado principal
% de la dinamica del juego, desplazando la fila o
% columna especificada en una cantidad de lugares
% hacia una determinada direccion.
%
% +Dir: Direccion de desplazamiento de la fila o
%       columna.
% +Num: Numero de fila o columna a desplazar.
% +Cant: Cantidad de lugares a desplazar la fila
%        o columna. Requiere que sea un entero
%        entre 1 y 4.
% +Tablero: Tablero de juego sobre el cual se
%           realiza el corrimiento.
% -EvoTablero: Parametro de salida que contiene la
%              evolucion del tablero al que se le
%              aplico el movimiento. Ver docs.
desplazar(der, Num, Cant, Tablero, EvoTablero) :-
    desplazar_fila(Num, Cant, Tablero, Tablero1),
    append(Tablero1, [], Aux),
    recorrer_columnas(Aux, Num, EvoTablero).

desplazar(izq, Num, Cant, Tablero, EvoTablero) :-
    desplazar_fila(Num, (-Cant), Tablero, Tablero1),
    append(Tablero1, [], Aux),
    recorrer_columnas(Aux, Num, EvoTablero).

desplazar(arriba, Num, Cant, Tablero, EvoTablero) :-
    desplazar_columna(Num, (-Cant), Tablero, Tablero1),
    append(Tablero1, [], Aux),
    recorrer_filas(Aux, Num, EvoTablero).

desplazar(abajo, Num, Cant, Tablero, EvoTablero) :-
    desplazar_columna(Num, Cant, Tablero, Tablero1),
    append(Tablero1, [], Aux),
    recorrer_filas(Aux, Num, EvoTablero).

% El predicado desplazar_fila desplaza la N-esima
% fila del tablero en una determinada cantidad de
% posiciones. (Derecha o Izquierda).
%
% +N: Numero de fila a desplazar
% +Cant: Cantidad de posiciones a desplazar la fila
% +T: Tablero, dividido en Head|Tail
% -D: Fila desplazada... Creo que aca se rompe todo
desplazar_fila(N, Cant, [T|Ts], [T|D]) :-
    N > 0,
    N1 is N-1,
    desplazar_fila(N1, Cant, Ts, D).
desplazar_fila(0, Cant, [T|Ts], D) :-
    rotar_n(Cant, T, D1),
    append([D1], Ts, D).

% El predicado desplazar_columna desplaza la N-esima
% columna del tablero en una determinada cantidad de
% posiciones. (Arriba o Abajo).
% Para simplificar la operatoria, el desplazamiento
% se reduce a trasponer la matriz que representa al
% tablero, luego se desplaza la fila correspondiente,
% y finalmente, se vuelve a trasponer la matriz a su
% version original.
%
% Los parametros son los mismos que desplazar_fila
desplazar_columna(N, Cant, Tablero, D) :-
    transpose(Tablero, Trasp),
    desplazar_fila(N, Cant, Trasp, D1),
    transpose(D1, D).

% El predicado rotar_n desplaza una lista N posiciones
% a derecha o izquierda, segun el signo de N.
%
% +N: Cantidad de posiciones a desplazar. Derecha si
%     N > 0, izquierda si N < 0.
% +L1: Lista a rotar.
% -L2: Lista rotada.
rotar_n(0, L, L).
rotar_n(N, L1, L2) :-
    N < 0,
    rotar("izq", L1, L),
    N1 is N+1,
    rotar_n(N1, L, L2).
rotar_n(N, L1, L2) :-
    N > 0,
    rotar("der", L1, L),
    N1 is N-1,
    rotar_n(N1, L, L2).

rotar("der", L, [T|H]) :- append(H, [T], L).
rotar("izq", [H|T], L) :- append(T, [H], L).

% El predicado posicion_lista/2 es un predicado auxiliar que toma el
% elemento en la lista en la posicion P y lo almacena en la variable E.
posicion_lista([A | _Tail], 0, A).

posicion_lista([_A | Tail], Pos, E):-
    P1 is Pos-1,
    posicion_lista(Tail, P1, E).

% El predicado obtener_columna/3 recibe como parametro una lista de listas (un tablero), 
% una posici칩n y almacena la columna en dicha posicion en la variable F.
obtener_columna(Tablero, N, R):-
    transpose(Tablero, TableroTransp),
    obtener_fila(TableroTransp, N, R).

% El predicado obtener_fila/3 recibe como par치metro una lista de listas (un tablero),
% una posicion y almacena la fila en dicha posici칩n en la variable F.
obtener_fila([A | _Tail], 0, A).

obtener_fila([_A | Tail], N, F):-
    N1 is N-1,
    obtener_fila(Tail, N1, F).

% El predicado intercambiar/4 intercambia el elemento en la posicion N
% en la lista por el elemento E y almacena el resultado en T.
intercambiar([_A | Tail], 0, E, [E | Tail]).

intercambiar([A | Tail], N, E, T):-
    N1 is N-1,
    intercambiar(Tail, N1, E, R),
    append([A], R, T).

% El predicado recorrer_columnas/3 recorre todas las columnas del tablero.
%  Luego, colapsa todas las mamushkas que pueda sobre el elemento Principal.
recorrer_columnas(Tablero, Principal, Res):-
    transpose(Tablero, TableroTransp),
    recorrer_filas(TableroTransp, Principal, Aux),
    transpose(Aux, Res).

% El predicado recorrer_filas/3 recorre todas las filas del tablero. Luego, colapsa todas
% las mamushkas que pueda sobre el elemento Principal.
recorrer_filas(Tablero, Principal, Res):-
    recorrer_filas_aux(Tablero, Principal, 0, Res).
    
recorrer_filas_aux(Tablero, Principal, 4, Res):-
    obtener_fila(Tablero, 4, Fila),
    verificar_consec(Fila, Principal, R),
    intercambiar(Tablero, 4, R, Res).

recorrer_filas_aux(Tablero, Principal, N, Res):-
    N1 is N+1,
    obtener_fila(Tablero, N, Fila),
    verificar_consec(Fila, Principal, R),
    intercambiar(Tablero, N, R, Aux),
    recorrer_filas_aux(Aux, Principal, N1, Res).

% El predicado verificar_consec/3 verifica que hayan, al menos, 3
% elementos consecutivos iguales en una lista. Luego, los colapsa
% sobre el elemento Principal. Utiliza el predicado auxiliar
% verificar_consec_aux/7
verificar_consec(L, Principal, F):-
    posicion_lista(L, 0, P0),
    posicion_lista(L, 1, P1),
    posicion_lista(L, 2, P2),
    posicion_lista(L, 3, P3),
    posicion_lista(L, 4, P4),
    verificar_consec_aux(L, Principal, P0, P1, P2, P3, P4, F).

verificar_consec(L, _Principal, L).

verificar_consec_aux(L, Principal, P0, P1, P2, P3, P4, L4):-
    P0 == P1,
    P1 == P2,
    P2 == P3,
    P3 == P4,
    posicion_lista(L, Principal, M),
    aumentar(M, MAum),
    intercambiar(L, 1, x, L0),
    intercambiar(L0, 2, x, L1),
    intercambiar(L1, 3, x, L2),
    intercambiar(L2, 4, x, L3),
    intercambiar(L3, Principal, MAum, L4).

verificar_consec_aux(L, Principal, P0, P1, P2, P3, _P4, L4):-
    P0 == P1,
    P1 == P2,
    P2 == P3,
    posicion_lista(L, Principal, M),
    aumentar(M, MAum),
    intercambiar(L, 0, x, L0),
    intercambiar(L0, 1, x, L1),
    intercambiar(L1, 2, x, L2),
    intercambiar(L2, 3, x, L3),
    intercambiar(L3, Principal, MAum, L4).

verificar_consec_aux(L, Principal, _P0, P1, P2, P3, P4, L4):-
    P1 == P2,
    P2 == P3,
    P3 == P4,
    posicion_lista(L, Principal, M),
    aumentar(M, MAum),
    intercambiar(L, 1, x, L0),
    intercambiar(L0, 2, x, L1),
    intercambiar(L1, 3, x, L2),
    intercambiar(L2, 4, x, L3),
    intercambiar(L3, Principal, MAum, L4).


verificar_consec_aux(L, Principal, P0, P1, P2, _P3, _P4, L3):-
    P0 == P1,
    P1 == P2,
    posicion_lista(L, Principal, M),
    aumentar(M, MAum),
    intercambiar(L, 0, x, L0),
    intercambiar(L0, 1, x, L1),
    intercambiar(L1, 2, x, L2),
    intercambiar(L2, Principal, MAum, L3).

verificar_consec_aux(L, Principal, _P0, P1, P2, P3, _P4, L3):-
    P1 == P2,
    P2 == P3,
    posicion_lista(L, Principal, M),
    aumentar(M, MAum),
    intercambiar(L, 1, x, L0),
    intercambiar(L0, 2, x, L1),
    intercambiar(L1, 3, x, L2),
    intercambiar(L2, Principal, MAum, L3).

verificar_consec_aux(L, Principal, _P0, _P1, P2, P3, P4, L3):-
    P2 == P3,
    P3 == P4,
    posicion_lista(L, Principal, M),
    aumentar(M, MAum),
    intercambiar(L, 2, x, L0),
    intercambiar(L0, 3, x, L1),
    intercambiar(L1, 4, x, L2),
    intercambiar(L2, Principal, MAum, L3).


%%%%%%%%%%%%%%##%########################################%#%%%###################%###(((//////(((((((##%%%%%%%%%%%%%%%%#%############################%%%%%%%%%%%%%%%&&%&&&&&&&&&&&&&&&&&&&&&&%%%%%%%%%%%
%%%%%%%%%%%%#%######################################################################(#((/////////(((((#####%%################################%%%%%%%%%&%&&&&&&&&&&&&&&&&&&%%%%%%%%%%#%%%##%#############
%%%%%%%%###%#############%########################################################%#((#(##%%%&%((((((####################%%%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%##############################%%%%
%%%%%%%%%%%###################################################(#####################%&#&%&%&&&&&&@@&%%%%%%%%%%%%%%%%%%%%%%%&%%%%%%%%%%%%%%%%%%%%######################################%%%%%%%%%%%%%%%%%%
%%%%###################################################################%#%%%&@%&%&&&@&&&&&@%&&&@@@@@@@@@%%%&&&&&%%%%%%%%%%%%%%######################################%%%%%%%%%%%%%%%%%%%%%&&&&&&&&&&&&&&&
%####################################################################%%&&&&@@@&@@@@&&@@%&&@@@&@@@@@@@@@@%&&%%%%%%%#####################################%%%%%%%%%%%%%%%%%%%%%%%&&&&&&&&&&&&&&&%%%%%%%%%%%
%##################################################################&&&&&&&@@@@@@&&%&&&@@@@@&@@@@@@@@&@&&&&&@%##########################%%%%%%%%%%%%%%%%%%%%%%%&&&&&&&&&&%%%%%%%%%%%%%%%%%%%#############
%#############################################################%&%&&&&@@@@@@@@@&%%&&%%&@@@@@@@@@&%&&&@%&%@&&@@&%#%###%%%%%%%%%%%%%%%%%%%%%%%%%&%%%%%%%%%%%%%%%%%%%%######################################
%##########################################################%%&&#&&&@@@@@@@@@&&&@&&&&@@@@@@@&@&@@@@@@&&@@&@@@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%############################################%%%#%%%%%%%%%%%
%########################################################%&&@&&&%@@@@@@@@&@@@&&&%&&&@@&@@@@@@@@@@@@@@@@@@@@@@@@@@&%%%%%%%%%%%#############################################%%%%%%%%%%%%%%%%%%&%&&&&&&&&&&
%#######################################################%@@@&%%&@&@@@@@@@@&@@&&%&&@@@@@@@@@&@&&&@@@@@@@@@@@@@@@@@@@######################################%%%%%%%%%%%%%%%%%%%%&&&&&&&&&&&&&&&&&&&&&&%%%%%
%########################################################@&&%%&%&&@@@@@@@@@@&%&&&@@@@&&&%@@&@&@@@@@@@@@@@@@@@@@@@@@@@&#################%%%%%%%%%%%%%%%%%%%%%%%%%&%&&&&&%&%%%%%%%%%%%%%%%%##%############
%######################################################%@@&&%&#&@@@@@@@@@@@&%%%%%&@@@@&@&@@@@@@@&&@@@@@@@@@@@@@@@@@@@@@&%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%##%#%#################################
%#####################################################%@&&&&%&&@@@@@@@@@@@@&%&&&%&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%%%%%%%%%%%%%%%#%%##%###############################################%%%%%%%%%%%
%#####################################################&@&&&@%&&&&&@@@@@@@@@@&%%%%&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%######################################%%%%%%%%%%%%%%%%%%%%%%%%%%&&&&&&&&&&&
%######################################################@@@@@&&&#&&&@@@@@@@@@@&@@@&@&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@######################%%%%%%%%%%%%%%%%%%&%&&&&&&&&&&&&%&&&&&&&&&&%&%%&%%%%%%%%
%####################################################%@@@@@&&%&&@@@@@@@@@@@@@&%#%&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%#%%%%%%%%%%%%%%%&%%%%%%&&&&&&&%&&&&&%%%%%%%%%%%%%%%%%%%%####################
%#####################################################@@@@@&%%%%&&@@@@&&%&%%%#(##%%&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&%&&&&&&&&%%%%%%%%%%%%%%%####################(########((((###############
%#####################################################%@@@@@@&%&@@@@&@&&%%###(//*((###%&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%%%%%%#%%###############(#((((((((#((((((((((##((##############%%%%%%%%%%%%%
%#####################################################%%@@@@@@@@@@@@@&%####(/**,,,,**///(#%%%&@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%###########(#((((##(#####################%%%%%%%%%%%%%%%%%%&&&&&&&&&&&&&&
%#######################################################@@@@@@@@@@@&%%#(/***,,,,*/**/(#%%&%###%%%&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@##############%%%%%%%%%%%%%%%%%%&&&%%%%%&&&&&&&&&&&&&&&&&&&&&&&&&&&&%&&%%
%#######################################################@@@@@@@@@&&%%(((****,*,*//((%#(/***/(#%#%%%##%%%%&&@@@@@@@@@@@@@@@@@@@@&%%%%%&%%%%%%&&&&&&&&&&&&&&&&&&&&&&&%&%%%%%%%%%%%%%%%%%%#################
%########################################################@@@@@@@@@@&&%%##(((*,,/#&&%/(&&#&&&@#%%#(/*/**/(###%&@@@@@@@@@@@@@@@@@&&&&&&&&&&%%%%%%%%%%%%%%%%%###########################(#######(#((((#(###
%########################################################@@@@@@&&%#(**//((((/,.*(%%%*********/((*,,****//(##%%&@@@&&&&@@@&@@@@@@&%#######################(##########################################%%%%
%#################################(######################@@@@@((//#@%%@@///,*,,,*#%#(*,,,**/,,,,,,****///(#%%%%%&%&%%&&%%&@@@@@@#########((##(##########################%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&&&
%#%###########################(####(######################%@@@*(//***,*//*,,*, ,/(##(/,,,,,,,,,,,,*****/(##%%%%&%%%%%%%%%%@@@&################%#%%%%%%%%%%%%%%%%%%%%%%%%&%&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
%#########################(#####(###########################%@**,,,,,,*,.,.,*, ,*((###(/*,,,,,,******//(##%%%%%&%%%%%%%###@@@&%%%%%%%%%%%%%%%&%&%%%&&&&&&&&&&%%&%%&&%%%&%%%%%%%%%%%%%%%%%%%%%###########
%#############################(#(#############################*/,,,,..,.,**/,,..,/////*(#&#/*****////(##%%%%%&%%%%%%%%%%&&@@@&&&%&%&&%%%%%%%%%%%%%%%%%%%%%################((((((((((((((((((((((((((((((
%##########################################################(###,,,*,,,,,*#*,,,..,**/*/#%%&%#(/////(##%%%%#&%%%%%%&%%%%%%@@@@@%###############(#(#((((((((((((((((((((((((((((((((((((((((((((###########
%############################################################(#/****,***#&//,,,,*/(%@@@&%%%####(/((#%%%%#(#%%%%%&&&&&&%&%@@%###(((((((((((((((((((((((((((((((#(#####################%%%%%%%%%%%%%%%%%%%
%###############################################################(//***/#%#/***((##&&&&%%#((#%%&%///*/(#%%/((%%%&&&&&&&&&&@@@@##############################%%%%%%%%%%%%%%%%%%%%%&&%&%&&&&&&&&&&&&&&&&&&&
%#################################################################*//*/(/*/***,,,,/#(##((##%&&@@@&%**(#%%(/(#%&&&&&&&&&&&@@@@%#@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%####
%##################################################################***/*//*(/(###%%%#((%#@@@%#%%%((/*/(#%#((&%&&@&&&&&&&@@@@@%#@@@@@@&%%%%%%%%%%%%%%%%%%%%#############(#####((((((((((#((((((((((((((((
%##################################################################******/#(/*///***,,**/(##%%%#((/(**(#%%(#&&&&&&&&@&@%@@@@@%@@@@@@@@@&&&#(((((((((((((((((((((((((((((((((((((((((((((((((((##########
%###################################################################******(/***/**/*/##%%#(#((##(//**//#&##%&&&&&&&@@@%@@@@@%@@@@@@@@@@@@@@&&&&&&((((((((((((((((((((((#######################%%%%%%%%%%
%#####################################################################****/**********/*/*//(((/(//**//(%##%&&&@&&@@@%@@@@@@%@@@@@@@@@@&@@&&&&&&&&&&&&&#######%%#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&&&&&&&&&&&
%############################################################%%%%&&&&%&/*//,,,****,,,,,,***/*///*//(#%#%%&&&&@@&&@@@@@@@@@%@@@@@@@@@@@@@@&&&&&&&&&&&%&&%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#%#
%###################################################%%%%%%%%%%%%%&&&&&&&&*//*,**,,,,,,,,****///*(#%&&%%&&&&&@@@@((@@@@@@%#@@@@@@@@@@@@@@@&&&&&&&&&%&&%&&&&&&&%&&&%%#############(##(##(((((#((((((((((((
%##############################################%&%%%%%%%%%%%%%%%%&&&%%%&&&&/(/*,**,******//((###&&&&&&&&&&@@@@(#%@@@@@@&@@@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&%%%(((((((((((((((((((####(#######
%%###########################################%&%%%%%%%%&%%%&%&%&&&&&&&&@@@@@@(/(/*//(((((#%%%%%&&%&&&&&&@&&(#&&@@@@@@%%@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&########%#%%%%%%%%%%%%%%%%%
%%%########################################%&&%&%%%&&&%&&&&&&&&&&&&&&@@@@@@@@@@&#(((%%%%%%%%%%%%%%%%%&&(((/(@@@@@@@&&@@@@@@@&@&@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@&&&&&@@@@%%%%%&%&&&&&&&&&&&&&&&&&
%#########################################%@&&&%&%%%&&&&&&&&&&&&&&&@@@@@@@@@&&&&&@@@  %###%%%%%%%%%//((/(%@@@@@@@&%@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@@@@@@@@@%%%%%%%%%%%%%%%%%%%%%
%########################################&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@@@@&&&&&@@@@@@@ ,   ((/,////((##@@@@@@@@&%@@@@@@@&&@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@@@@@@@@@@@@(((((((#(##(((((###
%#######################################&&@&&%&&&&&&&&&&&&&&&&&&@@@@@@@@&&&&&&@@@@@@@@(     ..,,*///@@@@@@@&&%@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@&@@@@@@@@@@@@@@@@@@@@(#((((((##########
%#######################################&&@&&&&&&&&&&&&&&&&&&&@@@@@@@@@&&&&&&@@@@@@@@@/           @@@@@@#(#&@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@######%#%%%%%%%%%
%%%%%%##################################&@&&&&&&&&&&&&&&&&&&@@@@@@@@@@&&&&&&&@@@@@@@@@*          @@@@@&(&@@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@&&&%&&&&&&&&&&&&&
%%#######((((((((#####################%&&&@&&&&&&&&&&&&&&&&@@@@@@@@&&&@@&((&@@@@@@@@@#*         @@@@@@@@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@&&@@@@@@@@@@@@@@@@@@@@@@@@@@@&%%%%%%%%%%%##%#%
%#####(((((((((//(((#################&&&&&@&&&&&&&&&&&&&&@@@@@@@@@&#%@&@@@@@@@@@&&@@@*,.       /@@@@@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@#((((((((((((((((
%#((((((((((((///////(((############&&&&&&&&&&&&&&&&&&&@@@@@@@@&&@%@&@@/&@@@@@@@@@@@@,,.       &&@@@@@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@((((((((((######
%###((((((((///(/////////((#######%&&&&&&&&&&&&&&&&&&&@&@@@@@@&&&&%#@&&&%@@@(@@@@@%@(,.      (/@@@@@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@####%#%%%%%%%%%
%##((((((((((((////////////(((##&&&&&&&&&&&&&&&&&&&@&@@@@@@@@@&&&&@@@&%%&@@@@@@@@@%@/..    ,  @@@@@@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%&&%&&&&&&&&&
%(((((((((((((((((//////((((#&&&&&&&@&&&&&&&&&&&&&&&@@@@@@@&&&&&&&@@@@%@@@@@@@@@@@@&*.       ,@@@@@@@@@@@@@@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%%%%%%%%%%%
%((((((((((((//((((((((##%&&&&&&&&&&&@@&&@&&&&&&&@@@@@@@@&&&&&&&&&&@@@@&#@@@@@@@@@@(,.    .   @@@@@@@@@@@@&@@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@@&@@@@@@@@@@@@@@@@@@&@@@@@@@@@@@@@@@@@@@@@@##########
%(((((((((((((((###%&&&&&&&&&&&&&&@@@@@@@&&&&&&&&@@@@@@&&&&&&&&&&&&@@@&%&&@@@@@@@&@/,.    ....@@@@@@@@@@@@@&@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&@@@@@@@&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@##########
